<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title> Feature Space Visualization </title>
<script src="https://d3js.org/d3.v7.min.js"></script>
<style>
  body {
    padding: 15px;
  }
  .scatter-img {
    position: absolute;
    pointer-events: none;
    max-width: 500px;
    max-height: 500px;
    object-fit: contain;
  }

  .legend {
    font-family: sans-serif;
    font-size: 14px;
  }

  .axis-label {
    font-family: sans-serif;
    font-size: 14px;
  }

  .title {
    font-family: sans-serif;
    font-size: 18px;
    text-anchor: middle;
  }
</style>
</head>
<body>

<script>
d3.json("d3_data.json").then(data => {
    
    const width = 700;
    const height = 500;
    const margin = {top: 100, right: 80, bottom: 80, left: 80};

    // create svg container
    const svg = d3.select("body")
      .append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .append("g")
      .attr("transform", `translate(${margin.left},${margin.top})`);

    svg.append("text")
      .attr("class", "title")
      .attr("x", width / 2)
      .attr("y", -margin.top / 2)
      .text("Feature Space Scatter Plot");

    // scales
    const xScale = d3.scaleLinear()
      .domain(d3.extent(data, d => d.x))
      .range([0, width]);

    const yScale = d3.scaleLinear()
      .domain(d3.extent(data, d => d.y))
      .range([height, 0]);

    // colors
    const colorScale = d3.scaleOrdinal()
      .domain([0, 1])
      .range(["green", "red"]);

    // axes
    const xAxis = d3.axisBottom(xScale);
    const yAxis = d3.axisLeft(yScale);

    svg.append("g")
      .attr("transform", `translate(0,${height})`)
      .call(xAxis);

    svg.append("g")
      .call(yAxis);

    // axis labels
    svg.append("text")
      .attr("class", "axis-label")
      .attr("x", width / 2)
      .attr("y", height + 40)
      .attr("text-anchor", "middle")
      .text("x");

    svg.append("text")
      .attr("class", "axis-label")
      .attr("x", -height / 2)
      .attr("y", -45)
      .attr("transform", "rotate(-90)")
      .attr("text-anchor", "middle")
      .text("y");

    // data points
    svg.selectAll("circle")
      .data(data)
      .enter()
      .append("circle")
      .attr("cx", d => xScale(d.x))
      .attr("cy", d => yScale(d.y))
      .attr("r", 6)
      .attr("fill", d => colorScale(d.label))
      .attr("opacity", 0.7)
      .on("mouseover", function(event, d) {
          const imgWidth = Math.min(500, window.innerWidth * 0.5);
          const imgHeight = Math.min(500, window.innerHeight * 0.5);

          // keep image inside view
          const left = (event.pageX + imgWidth + 20 > window.innerWidth)
              ? event.pageX - imgWidth - 10
              : event.pageX + 10;

          const top = (event.pageY + imgHeight + 20 > window.innerHeight)
              ? event.pageY - imgHeight - 10
              : event.pageY + 10;

          d3.select("body").append("img")
            .attr("class", "scatter-img")
            .attr("src", d.img)
            .style("width", imgWidth + "px")
            .style("height", imgHeight + "px")
            .style("left", left + "px")
            .style("top", top + "px");
      })
      .on("mousemove", function(event) {
          d3.select(".scatter-img")
            .style("left", (event.pageX + 10) + "px")
            .style("top", (event.pageY + 10) + "px");
      })
      .on("mouseout", function() {
          d3.select(".scatter-img").remove();
      });

    // legend
    const legendData = [
        {label: "normal", color: "green"},
        {label: "abnormal", color: "red"}
    ];

    const legend = svg.append("g")
      .attr("class", "legend")
      .attr("transform", `translate(${width}, 0)`);

    legend.selectAll("rect")
      .data(legendData)
      .enter()
      .append("rect")
      .attr("x", 0)
      .attr("y", (d,i) => i * 20)
      .attr("width", 12)
      .attr("height", 12)
      .attr("fill", d => d.color);

    legend.selectAll("text")
      .data(legendData)
      .enter()
      .append("text")
      .attr("x", 18)
      .attr("y", (d,i) => i * 20 + 10)
      .text(d => d.label);
});
</script>
</body>
</html>
